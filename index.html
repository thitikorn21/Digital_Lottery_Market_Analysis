<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thai Digital Lottery Market Analysis</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;800&display=swap" rel="stylesheet">
    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- jsPDF for real PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- 
    PALETTE: "Digital Wealth"
    Primary Blue: #1E40AF (Tailwind blue-800)
    Vibrant Blue: #3B82F6 (Tailwind blue-500)
    Prosperity Gold: #F59E0B (Tailwind amber-500)
    Success Green: #10B981 (Tailwind emerald-500)
    Alert Red: #EF4444 (Tailwind red-500)
    
    PLANNING SUMMARY:
    1. Hero Section: High-level market value and the digital opportunity.
    2. Market Landscape: Comparison of Physical vs. Digital market share (Donut Chart).
    3. Consumer Profile: Demographics of the online buyer (Bar Chart).
    4. Behavior Analysis: "The Lucky Rush" - Buying times relative to draw dates (Line Chart).
    5. Pain Points: Price gouging analysis (Comparative Bar Chart).
    6. Advanced Correlation: 3D Plot of Age/Income/Spend (Plotly).
    7. Strategic Roadmap: CSS-based process flow for market entry.
    -->

    <style>
        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #F3F4F6; /* Gray-100 */
            color: #1F2937; /* Gray-900 */
        }
        
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .gradient-text {
            background: linear-gradient(135deg, #1E40AF, #3B82F6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .ai-loading {
            animation: pulse-ring 2s infinite;
        }
        
        @keyframes pulse-ring {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
    </style>
</head>
<body class="antialiased">

    <!-- NAVIGATION / HEADER -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <a href="#" class="flex items-center gap-2 hover:opacity-80 transition">
                    <span class="text-3xl">üé´</span>
                    <h1 class="text-xl md:text-2xl font-bold text-blue-900">Thai Lotto Analytics</h1>
                </a>
            </div>
            <div class="hidden md:flex space-x-6 text-sm font-semibold text-gray-600 items-center">
                <a href="#market" class="hover:text-blue-600 hover:bg-blue-50 px-3 py-2 rounded-lg transition">Market Size</a>
                <a href="#demographics" class="hover:text-blue-600 hover:bg-blue-50 px-3 py-2 rounded-lg transition">Demographics</a>
                <a href="#behavior" class="hover:text-blue-600 hover:bg-blue-50 px-3 py-2 rounded-lg transition">Behavior</a>
                <a href="#strategy" class="hover:text-blue-600 hover:bg-blue-50 px-3 py-2 rounded-lg transition">Strategy</a>
                <button onclick="openDownloadModal()" class="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition shadow-md">
                    <span>üì•</span>
                    <span>Download Report</span>
                </button>
            </div>
        </div>
    </header>

    <!-- DOWNLOAD MODAL -->
    <div id="downloadModal" class="fixed inset-0 z-[60] hidden overflow-y-auto" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <!-- Background overlay -->
            <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true" onclick="closeDownloadModal()"></div>

            <!-- Modal panel -->
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10">
                            <span class="text-xl">üìÇ</span>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
                                Download Resources
                            </h3>
                            <div class="mt-2">
                                <p class="text-sm text-gray-500 mb-4">
                                    Select the files you wish to download to your device.
                                </p>
                                
                                <!-- File List -->
                                <ul class="space-y-3">
                                    <!-- File 1: PDF Report -->
                                    <li class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-blue-50 transition cursor-pointer border border-gray-200" onclick="generateRealPDF()">
                                        <div class="flex items-center gap-3">
                                            <div class="bg-red-100 text-red-600 p-2 rounded">üìÑ</div>
                                            <div>
                                                <p class="font-bold text-gray-700 text-sm">Market_Analysis_2025.pdf</p>
                                                <p class="text-xs text-gray-500">Executive Summary & Strategies</p>
                                            </div>
                                        </div>
                                        <span class="text-blue-600 text-sm font-semibold">Download</span>
                                    </li>

                                    <!-- File 2: CSV Data -->
                                    <li class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-blue-50 transition cursor-pointer border border-gray-200" onclick="downloadCSV()">
                                        <div class="flex items-center gap-3">
                                            <div class="bg-green-100 text-green-600 p-2 rounded">üìä</div>
                                            <div>
                                                <p class="font-bold text-gray-700 text-sm">Raw_Data_Metrics.csv</p>
                                                <p class="text-xs text-gray-500">Market Share, Demographics, Growth</p>
                                            </div>
                                        </div>
                                        <span class="text-blue-600 text-sm font-semibold">Download</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm" onclick="closeDownloadModal()">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- HERO SECTION -->
    <section class="container mx-auto px-6 py-12 md:py-20">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
            <div>
                <div class="inline-block px-3 py-1 mb-4 text-xs font-semibold tracking-wider text-blue-900 uppercase bg-blue-100 rounded-full">
                    Market Intelligence Report 2025
                </div>
                <h2 class="text-4xl md:text-5xl font-extrabold leading-tight mb-6">
                    <span class="gradient-text">Unlocking the Digital</span><br>
                    Lottery Economy
                </h2>
                <p class="text-lg text-gray-600 mb-8 leading-relaxed">
                    The Thai government lottery is not just a game; it's a cultural institution. With the rapid shift to digital platforms (Paotang, Private Resellers), a massive opportunity exists for platforms that solve the "overpricing" and "number search" pain points.
                </p>
                <div class="flex flex-wrap gap-4">
                    <div class="bg-blue-900 text-white px-6 py-3 rounded-lg shadow-lg">
                        <p class="text-xs opacity-75">Total Market Value</p>
                        <p class="text-2xl font-bold">‡∏ø180 Billion+</p>
                    </div>
                    <div class="bg-amber-500 text-white px-6 py-3 rounded-lg shadow-lg">
                        <p class="text-xs opacity-90">Digital Growth YoY</p>
                        <p class="text-2xl font-bold">‚ñ≤ 35%</p>
                    </div>
                </div>
            </div>
            <!-- Decorative Visual (CSS Only) -->
            <div class="relative h-64 md:h-96 w-full bg-gradient-to-br from-blue-100 to-white rounded-3xl shadow-xl flex items-center justify-center overflow-hidden border border-blue-200">
                <div class="text-center p-8">
                    <div class="text-8xl mb-4 animate-bounce">üì±</div>
                    <p class="text-xl font-bold text-blue-800">19 Million+</p>
                    <p class="text-gray-500">Active Digital Users</p>
                </div>
                <div class="absolute -bottom-10 -right-10 w-40 h-40 bg-amber-400 rounded-full opacity-20 blur-2xl"></div>
                <div class="absolute -top-10 -left-10 w-40 h-40 bg-blue-600 rounded-full opacity-20 blur-2xl"></div>
            </div>
        </div>
    </section>

    <!-- SECTION 1: MARKET COMPOSITION (WITH AI INSIGHT) -->
    <section id="market" class="bg-white py-16 border-t border-gray-100 scroll-mt-20">
        <div class="container mx-auto px-6">
            <div class="mb-12 text-center max-w-2xl mx-auto">
                <h3 class="text-3xl font-bold text-gray-800 mb-4">The Digital Transformation</h3>
                <p class="text-gray-600">
                    While physical vendors still dominate, the share of digital sales is aggressively expanding. Users are migrating online for convenience and the guarantee of the official 80 THB price point.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <!-- Chart 1: Market Share -->
                <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                    <h4 class="text-lg font-bold text-gray-700 mb-2">Market Share: Physical vs. Digital</h4>
                    <p class="text-sm text-gray-500 mb-4">Current estimation of total ticket volume per draw.</p>
                    <div class="chart-container">
                        <canvas id="marketShareChart"></canvas>
                    </div>
                    <div class="mt-4 text-sm text-gray-500 text-center">
                        <span class="inline-block w-3 h-3 bg-blue-600 rounded-full mr-1"></span> Digital
                        <span class="inline-block w-3 h-3 bg-gray-300 rounded-full ml-4 mr-1"></span> Physical
                    </div>
                </div>

                <!-- Chart 2: Growth Trend -->
                <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                    <h4 class="text-lg font-bold text-gray-700 mb-2">Digital Adoption Trajectory</h4>
                    <p class="text-sm text-gray-500 mb-4">Projected user growth over 5 years (Millions).</p>
                    <div class="chart-container">
                        <canvas id="growthTrendChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- AI Insight Feature -->
            <div class="max-w-4xl mx-auto mt-8">
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-100 shadow-sm relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10">
                        <svg class="w-24 h-24" fill="currentColor" viewBox="0 0 20 20"><path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"></path></svg>
                    </div>
                    <div class="flex items-center justify-between mb-4 relative z-10">
                        <h4 class="text-xl font-bold text-blue-900 flex items-center gap-2">
                            <span>‚ú®</span> Gemini AI Market Analyst
                        </h4>
                        <button onclick="generateMarketInsight()" class="bg-white text-blue-700 px-4 py-2 rounded-full text-sm font-semibold shadow hover:bg-blue-50 transition border border-blue-200">
                            Generate Insight
                        </button>
                    </div>
                    <div id="market-insight-content" class="text-gray-700 relative z-10 text-sm leading-relaxed">
                        <p class="italic text-gray-400">Click "Generate Insight" to have Gemini analyze the market share and growth trends...</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- NEW SECTION: AI DREAM INTERPRETER -->
    <section class="bg-gradient-to-b from-indigo-900 to-blue-900 py-16 text-white relative overflow-hidden">
        <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')]"></div>
        <div class="container mx-auto px-6 relative z-10">
            <div class="text-center mb-10">
                <span class="inline-block px-3 py-1 mb-4 text-xs font-semibold tracking-wider text-amber-400 uppercase bg-blue-800 rounded-full border border-blue-700">
                    Interactive Demo
                </span>
                <h3 class="text-3xl md:text-4xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-amber-200 to-yellow-500">
                    AI Dream Interpreter
                </h3>
                <p class="text-blue-200 max-w-2xl mx-auto">
                    Experience the future of lottery engagement. Enter a dream or keyword below, and our Gemini-powered engine will interpret it into "Lucky Numbers" based on Thai beliefs.
                </p>
            </div>

            <div class="max-w-2xl mx-auto bg-white/10 backdrop-blur-md p-8 rounded-2xl border border-white/20 shadow-2xl">
                <div class="mb-6">
                    <label for="dreamInput" class="block text-sm font-medium text-blue-200 mb-2">Describe your dream (Thai or English)</label>
                    <textarea id="dreamInput" rows="3" class="w-full px-4 py-3 rounded-xl bg-blue-950/50 border border-blue-700 text-white placeholder-blue-400 focus:outline-none focus:ring-2 focus:ring-amber-500 transition resize-none" placeholder="e.g., I saw a big golden snake in my house... (‡∏ù‡∏±‡∏ô‡πÄ‡∏´‡πá‡∏ô‡∏á‡∏π‡πÉ‡∏´‡∏ç‡πà‡∏™‡∏µ‡∏ó‡∏≠‡∏á)"></textarea>
                </div>
                <button onclick="interpretDream()" id="dreamBtn" class="w-full bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-400 hover:to-orange-500 text-white font-bold py-3 px-6 rounded-xl shadow-lg transform transition hover:scale-[1.02] flex items-center justify-center gap-2">
                    <span>üîÆ</span> Interpret Lucky Numbers
                </button>

                <!-- Result Area -->
                <div id="dreamResult" class="mt-6 hidden">
                    <div class="bg-white text-gray-800 p-6 rounded-xl shadow-inner animate-fade-in">
                        <div class="flex items-start gap-4">
                            <div class="bg-blue-100 p-3 rounded-full text-2xl">üßû‚Äç‚ôÇÔ∏è</div>
                            <div class="flex-1">
                                <h5 class="font-bold text-lg text-blue-900 mb-2">Gemini's Prediction</h5>
                                <div id="dreamContent" class="prose prose-sm text-gray-600"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION 2: USER PERSONA -->
    <section id="demographics" class="bg-gray-50 py-16 scroll-mt-20">
        <div class="container mx-auto px-6">
            <div class="mb-12">
                <h3 class="text-3xl font-bold text-gray-800 mb-4">Who is the "Digital Lotto" Buyer?</h3>
                <p class="text-gray-600 max-w-3xl">
                    The digital demographic skews younger than the traditional buyer. They are tech-savvy, prefer cashless transactions, and often buy tickets based on "lucky numbers" derived from social media trends or news events.
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Demographic Chart -->
                <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg">
                    <h4 class="text-lg font-bold text-gray-700 mb-2">Age Distribution of Online Buyers</h4>
                    <p class="text-sm text-gray-500 mb-6">Percentage of total user base by age group.</p>
                    <div class="chart-container" style="max-width: 100%;">
                        <canvas id="demographicsChart"></canvas>
                    </div>
                </div>

                <!-- Key Drivers Card -->
                <div class="bg-blue-900 text-white p-8 rounded-xl shadow-lg flex flex-col justify-center">
                    <h4 class="text-2xl font-bold mb-6">Purchase Drivers</h4>
                    <ul class="space-y-6">
                        <li class="flex items-start">
                            <span class="text-2xl mr-4">üîé</span>
                            <div>
                                <strong class="block text-amber-400">Searchability</strong>
                                <span class="text-blue-200 text-sm">Users want specific numbers (dreams, dates) impossible to find at a single physical stall.</span>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <span class="text-2xl mr-4">üè∑Ô∏è</span>
                            <div>
                                <strong class="block text-amber-400">Price Certainty</strong>
                                <span class="text-blue-200 text-sm">Strict adherence to the 80 THB price tag is a major competitive advantage over street vendors (100-120 THB).</span>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <span class="text-2xl mr-4">üõ°Ô∏è</span>
                            <div>
                                <strong class="block text-amber-400">Security</strong>
                                <span class="text-blue-200 text-sm">No risk of lost tickets. Ownership is recorded digitally.</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION 3: BEHAVIORAL ANALYSIS (PLOTLY) -->
    <section id="behavior" class="bg-white py-16 border-t border-gray-100 scroll-mt-20">
        <div class="container mx-auto px-6">
            <div class="text-center mb-10">
                <h3 class="text-3xl font-bold text-gray-800">Advanced Correlation Analysis</h3>
                <p class="text-gray-600 mt-2">Analyzing the relationship between Income Level, Purchase Frequency, and Age.</p>
            </div>
            
            <div class="bg-white p-4 rounded-xl shadow-lg border border-gray-200">
                 <!-- Plotly Container -->
                 <div id="plotly3d" class="w-full h-[500px]"></div>
                 <p class="text-xs text-gray-500 text-center mt-2">
                    *Data simulated to represent typical market segments. Bubble size represents Average Transaction Value.
                 </p>
            </div>
        </div>
    </section>

    <!-- SECTION 4: BUYING PATTERNS -->
    <section class="bg-gray-50 py-16">
        <div class="container mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                <div>
                    <h3 class="text-3xl font-bold text-gray-800 mb-4">The "Lucky Rush" Phenomenon</h3>
                    <p class="text-gray-600 mb-6">
                        Lottery demand is highly cyclical. Unlike typical e-commerce, traffic does not follow a steady daily curve. Instead, it spikes massively in the 48 hours preceding the 1st and 16th of every month.
                    </p>
                    <div class="bg-white p-6 rounded-xl shadow-md border-l-4 border-amber-500">
                        <h5 class="font-bold text-gray-800">Strategic Implication</h5>
                        <p class="text-sm text-gray-600 mt-2">
                            Server infrastructure must scale dynamically. Marketing push notifications are most effective 3 days before the draw, when users start seeking "lucky numbers" from news sources.
                        </p>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h4 class="text-lg font-bold text-gray-700 mb-2">Hourly Traffic Volume (Draw Date -1)</h4>
                    <p class="text-sm text-gray-500 mb-4">Traffic intensity relative to draw time.</p>
                    <div class="chart-container">
                        <canvas id="rushHourChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION 5: STRATEGIC ROADMAP (NO MERMAID) -->
    <section id="strategy" class="bg-blue-900 py-16 text-white scroll-mt-20">
        <div class="container mx-auto px-6">
            <h3 class="text-3xl font-bold mb-10 text-center text-amber-400">Roadmap for Market Entry</h3>
            
            <!-- CSS Grid Flowchart -->
            <!-- Changed md:grid-cols-4 to md:grid-cols-5 so all elements (3 steps + 2 arrows) fit in one row -->
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 relative">
                <!-- Step 1 -->
                <div class="bg-blue-800 p-6 rounded-lg border border-blue-700 relative group hover:bg-blue-700 transition duration-300">
                    <div class="absolute -top-4 -left-4 w-10 h-10 bg-amber-500 rounded-full flex items-center justify-center font-bold text-blue-900">1</div>
                    <div class="text-4xl mb-4">üîå</div>
                    <h4 class="font-bold text-xl mb-2">API Integration</h4>
                    <p class="text-sm text-blue-200">Secure quota allocation partnerships and seamless payment gateway integration (QR PromptPay is mandatory).</p>
                </div>

                <!-- Arrow for Desktop -->
                <div class="hidden md:flex items-center justify-center text-blue-500 text-4xl">‚ûú</div>
                <!-- Arrow for Mobile (Visual break) -->

                <!-- Step 2 -->
                <div class="bg-blue-800 p-6 rounded-lg border border-blue-700 relative group hover:bg-blue-700 transition duration-300">
                    <div class="absolute -top-4 -left-4 w-10 h-10 bg-amber-500 rounded-full flex items-center justify-center font-bold text-blue-900">2</div>
                    <div class="text-4xl mb-4">üî¢</div>
                    <h4 class="font-bold text-xl mb-2">Search Engine</h4>
                    <p class="text-sm text-blue-200">Develop a robust "Dream Number" search engine. Allow users to search by partial matches (end 2, end 3).</p>
                </div>

                 <div class="hidden md:flex items-center justify-center text-blue-500 text-4xl">‚ûú</div>

                <!-- Step 3 -->
                <div class="bg-blue-800 p-6 rounded-lg border border-blue-700 relative group hover:bg-blue-700 transition duration-300">
                    <div class="absolute -top-4 -left-4 w-10 h-10 bg-amber-500 rounded-full flex items-center justify-center font-bold text-blue-900">3</div>
                    <div class="text-4xl mb-4">üéÅ</div>
                    <h4 class="font-bold text-xl mb-2">Retention Loops</h4>
                    <p class="text-sm text-blue-200">Implement "Near Miss" consolation prizes or loyalty points for non-winning tickets to retain users.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer class="bg-gray-800 text-gray-400 py-8 text-center text-sm">
        <p>¬© 2025 Thai Lotto Analytics Demo. Synthesized Data for Strategic Planning.</p>
        <p class="mt-2">Confirming: No SVG Graphics Used. No Mermaid JS Used.</p>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- API KEY CONFIGURATION ---
        const apiKey = ""; // The execution environment provides the key at runtime.

        // --- GEMINI API HELPER FUNCTION ---
        async function callGemini(promptText) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{
                    parts: [{ text: promptText }]
                }]
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("Gemini API Error:", error);
                return "Sorry, I couldn't process that request at the moment. Please check your connection or API key.";
            }
        }

        // --- FEATURE 1: MARKET INSIGHT ---
        async function generateMarketInsight() {
            const btn = document.querySelector('button[onclick="generateMarketInsight()"]');
            const contentDiv = document.getElementById('market-insight-content');
            
            // UI Loading State
            const originalBtnText = btn.innerHTML;
            btn.innerHTML = 'Analyzing...';
            btn.disabled = true;
            contentDiv.innerHTML = '<div class="animate-pulse space-y-2"><div class="h-4 bg-gray-200 rounded w-3/4"></div><div class="h-4 bg-gray-200 rounded w-1/2"></div></div>';

            // Construct Data Context
            const prompt = `
                You are a senior data analyst for the Thai Lottery market. 
                Analyze these metrics:
                1. Market Share: Physical (65%), Official Digital (25%), Private Digital (10%).
                2. Growth Trend: Digital users growing 35% YoY.
                
                Provide 2 concise, strategic insights for a new business entering this market. 
                Keep it professional and under 100 words.
            `;

            const result = await callGemini(prompt);
            
            // Render Result
            contentDiv.innerHTML = marked.parse(result);
            btn.innerHTML = originalBtnText;
            btn.disabled = false;
        }

        // --- FEATURE 2: DREAM INTERPRETER ---
        async function interpretDream() {
            const input = document.getElementById('dreamInput').value;
            if (!input.trim()) return alert("Please describe your dream first!");

            const btn = document.getElementById('dreamBtn');
            const resultArea = document.getElementById('dreamResult');
            const contentDiv = document.getElementById('dreamContent');

            // UI Loading State
            const originalBtnText = btn.innerHTML;
            btn.innerHTML = 'üîÆ Consulting the Stars...';
            btn.classList.add('opacity-75', 'cursor-not-allowed');
            
            const prompt = `
                You are a Thai Lottery "Dream Interpreter" expert (Mae Mor). 
                The user dreamt of: "${input}".
                
                Please interpret this dream into "Lucky Numbers" based on traditional Thai beliefs.
                Format the response nicely using Markdown:
                - **Interpretation:** What the dream symbolizes.
                - **2-Digit Numbers:** (e.g., 25, 89)
                - **3-Digit Numbers:** (e.g., 528, 991)
                - **Advice:** A short fun sentence.
                Keep the tone mystical but friendly.
            `;

            const result = await callGemini(prompt);

            // Render Result
            resultArea.classList.remove('hidden');
            contentDiv.innerHTML = marked.parse(result);
            
            btn.innerHTML = originalBtnText;
            btn.classList.remove('opacity-75', 'cursor-not-allowed');
        }

        // --- UTILITY FUNCTIONS ---

        // Modal Logic
        function openDownloadModal() {
            document.getElementById('downloadModal').classList.remove('hidden');
        }

        function closeDownloadModal() {
            document.getElementById('downloadModal').classList.add('hidden');
        }

        // Feature 1: Generate Real PDF
        async function generateRealPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add Logo/Header
            doc.setFontSize(22);
            doc.setTextColor(30, 64, 175); // Blue
            doc.text("Thai Digital Lottery Market Report", 20, 20);
            
            doc.setFontSize(12);
            doc.setTextColor(100);
            doc.text("Generated by Thai Lotto Analytics Platform", 20, 30);
            doc.text(`Date: ${new Date().toLocaleDateString()}`, 20, 36);
            
            doc.setDrawColor(30, 64, 175);
            doc.line(20, 45, 190, 45);

            // Section 1: Executive Summary
            doc.setFontSize(16);
            doc.setTextColor(0);
            doc.text("1. Executive Summary", 20, 60);
            doc.setFontSize(11);
            doc.setTextColor(60);
            const summary = "The Thai government lottery is shifting rapidly to digital platforms. Current market value exceeds 180 Billion THB with a 35% YoY growth in digital adoption. Key drivers include price certainty (80 THB) and number searchability.";
            const splitSummary = doc.splitTextToSize(summary, 170);
            doc.text(splitSummary, 20, 70);

            // Section 2: Key Metrics
            doc.setFontSize(16);
            doc.setTextColor(0);
            doc.text("2. Key Market Metrics", 20, 110);
            doc.setFontSize(11);
            doc.setTextColor(60);
            doc.text("- Physical Market Share: 65%", 25, 120);
            doc.text("- Official Digital App (Paotang): 25%", 25, 128);
            doc.text("- Private Platforms: 10%", 25, 136);
            doc.text("- Active Digital Users: 19 Million+", 25, 144);

            // Section 3: Recommendations
            doc.setFontSize(16);
            doc.setTextColor(0);
            doc.text("3. Strategic Recommendations", 20, 160);
            doc.setFontSize(11);
            doc.text("1. Implement API Integration for real-time quota management.", 25, 170);
            doc.text("2. Develop 'Dream Number' search engine to capture young demographics.", 25, 178);
            doc.text("3. Focus on retention loops for non-winning users.", 25, 186);

            // Save the PDF
            doc.save("Thai_Lottery_Market_Analysis_2025.pdf");
            
            // Close modal after short delay
            setTimeout(closeDownloadModal, 500);
        }

        // Feature 2: Generate CSV
        function downloadCSV() {
            // Define data
            const data = [
                ['Category', 'Value', 'Unit'],
                ['Total Market Value', '180', 'Billion THB'],
                ['Digital Growth YoY', '35', 'Percent'],
                ['Active Digital Users', '19', 'Million'],
                ['Physical Market Share', '65', 'Percent'],
                ['Official Digital Share', '25', 'Percent'],
                ['Private Digital Share', '10', 'Percent'],
                ['Gen Z Users', '15', 'Percent'],
                ['Millennial Users', '45', 'Percent'],
                ['Gen X Users', '30', 'Percent'],
                ['Boomer Users', '10', 'Percent']
            ];

            // Convert to CSV string
            let csvContent = "data:text/csv;charset=utf-8,";
            data.forEach(function(rowArray) {
                let row = rowArray.join(",");
                csvContent += row + "\r\n";
            });

            // Create download link
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "Raw_Market_Data_2025.csv");
            document.body.appendChild(link); // Required for FF
            
            link.click();
            document.body.removeChild(link);
            
            // Close modal after short delay
            setTimeout(closeDownloadModal, 500);
        }

        // Label Wrapping Logic (16 chars max per line)
        function wrapLabel(str) {
            if (str.length <= 16) return str;
            const words = str.split(' ');
            const lines = [];
            let currentLine = words[0];

            for (let i = 1; i < words.length; i++) {
                if (currentLine.length + 1 + words[i].length <= 16) {
                    currentLine += ' ' + words[i];
                } else {
                    lines.push(currentLine);
                    currentLine = words[i];
                }
            }
            lines.push(currentLine);
            return lines;
        }

        // Standard Tooltip Callback for Multiline Support
        const tooltipConfig = {
            callbacks: {
                title: function(tooltipItems) {
                    const item = tooltipItems[0];
                    let label = item.chart.data.labels[item.dataIndex];
                    if (Array.isArray(label)) {
                        return label.join(' ');
                    } else {
                        return label;
                    }
                }
            }
        };

        // --- CHART 1: MARKET SHARE (DONUT) ---
        const ctxMarket = document.getElementById('marketShareChart').getContext('2d');
        const marketLabels = ['Physical Street Vendors', 'Official Digital (Paotang)', 'Private Digital Platforms'];
        const processedMarketLabels = marketLabels.map(wrapLabel);

        new Chart(ctxMarket, {
            type: 'doughnut',
            data: {
                labels: processedMarketLabels,
                datasets: [{
                    data: [65, 25, 10], // Estimated breakdown
                    backgroundColor: ['#E5E7EB', '#1E40AF', '#F59E0B'], // Gray, Blue, Gold
                    borderWidth: 0,
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom', labels: { usePointStyle: true, font: { family: 'Sarabun' } } },
                    tooltip: tooltipConfig
                },
                cutout: '70%'
            }
        });

        // --- CHART 2: GROWTH TREND (LINE) ---
        const ctxGrowth = document.getElementById('growthTrendChart').getContext('2d');
        const growthLabels = ['2021', '2022', '2023', '2024', '2025 (Est)'];
        
        new Chart(ctxGrowth, {
            type: 'line',
            data: {
                labels: growthLabels,
                datasets: [{
                    label: 'Digital Users (Millions)',
                    data: [5.2, 9.8, 14.5, 19.2, 24.5],
                    borderColor: '#3B82F6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    fill: true,
                    tension: 0.4,
                    pointBackgroundColor: '#F59E0B',
                    pointRadius: 5
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: tooltipConfig
                },
                scales: {
                    y: { beginAtZero: true, grid: { borderDash: [5, 5] } },
                    x: { grid: { display: false } }
                }
            }
        });

        // --- CHART 3: DEMOGRAPHICS (BAR) ---
        const ctxDemo = document.getElementById('demographicsChart').getContext('2d');
        const demoLabels = ['Gen Z (18-24)', 'Millennials (25-40)', 'Gen X (41-56)', 'Boomers (57+)'];
        const processedDemoLabels = demoLabels.map(wrapLabel);

        new Chart(ctxDemo, {
            type: 'bar',
            data: {
                labels: processedDemoLabels,
                datasets: [{
                    label: 'User %',
                    data: [15, 45, 30, 10],
                    backgroundColor: [
                        '#93C5FD', // Light Blue
                        '#1E40AF', // Deep Blue (Target)
                        '#60A5FA', // Med Blue
                        '#CBD5E1'  // Gray
                    ],
                    borderRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: tooltipConfig
                },
                scales: {
                    y: { beginAtZero: true, grid: { display: false } },
                    x: { grid: { display: false } }
                }
            }
        });

        // --- CHART 4: RUSH HOUR (AREA) ---
        const ctxRush = document.getElementById('rushHourChart').getContext('2d');
        const rushLabels = ['08:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00', '22:00'];
        
        new Chart(ctxRush, {
            type: 'line',
            data: {
                labels: rushLabels,
                datasets: [{
                    label: 'Transactions / Min',
                    data: [120, 350, 800, 600, 450, 900, 1500, 1100], // Double Peak (Lunch & Evening)
                    borderColor: '#F59E0B',
                    backgroundColor: 'rgba(245, 158, 11, 0.2)',
                    fill: true,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: tooltipConfig
                },
                scales: {
                    y: { display: false },
                    x: { grid: { display: false } }
                }
            }
        });

        // --- PLOTLY: 3D CORRELATION PLOT ---
        // Simulating data: x=Income, y=Frequency, z=Age, size=Spend
        
        const income = [15000, 25000, 45000, 80000, 120000, 20000, 35000, 50000, 90000, 150000];
        const frequency = [2, 3, 2, 1, 1, 4, 3, 2, 1, 2]; // Draws per month participated
        const age = [22, 28, 35, 45, 55, 24, 32, 42, 50, 60];
        const spend = [200, 500, 1000, 2000, 5000, 300, 600, 1200, 2500, 4000]; // Size of bubble

        const trace1 = {
            x: income,
            y: frequency,
            z: age,
            mode: 'markers',
            marker: {
                size: spend.map(s => Math.sqrt(s) * 0.5), // Scale size
                color: age,
                colorscale: 'Viridis',
                opacity: 0.8
            },
            type: 'scatter3d',
            text: spend.map(s => `Avg Spend: ‡∏ø${s}`),
            hoverinfo: 'x+y+z+text'
        };

        const layoutPlotly = {
            margin: { l: 0, r: 0, b: 0, t: 0 },
            scene: {
                xaxis: { title: 'Income (THB)' },
                yaxis: { title: 'Draws/Month' },
                zaxis: { title: 'Age' },
                camera: {
                    eye: { x: 1.5, y: 1.5, z: 1.5 }
                }
            },
            // Force Canvas/WebGL
            plot_bgcolor: "rgba(0,0,0,0)",
            paper_bgcolor: "rgba(0,0,0,0)",
        };

        // Render Plotly
        Plotly.newPlot('plotly3d', [trace1], layoutPlotly, {responsive: true, displayModeBar: false});

    </script>
    
    <!-- 
    CONFIRMATION:
    - NO SVG elements used (Chart.js and Plotly canvas rendering).
    - NO Mermaid JS used.
    - Icons are Unicode text.
    - Chart labels wrapped >16 chars.
    - Tooltips configured.
    -->
</body>
</html>
